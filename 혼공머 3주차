## Ch4-1 ë¡œì§€ìŠ¤í‹±  íšŒê·€

### â€”>GOAL : ëŸ­í‚¤ë°±ì— í¬í•¨ëœ ìƒì„ ì˜ í™•ë¥ êµ¬í•˜ê¸°

SOL : k-ìµœê·¼ì ‘ ì´ì›ƒì„ ì´ìš©í•´ì„œ ì´ì›ƒì˜ í´ë˜ìŠ¤ ë¹„ìœ¨ì„ í™•ë¥ ì´ë¼ê³  ì¶œë ¥í•˜ë©´???

- ë°ì´í„° ì¤€ë¹„í•˜ê¸°

```python
import pandas as pd

fish = pd.read_csv('https://bit.ly/fish_csv_data')
fish.head() #ì²˜ìŒ ë‹¤ì„¯ ê°œì˜ ì—´ì„ ì¶œë ¥ì‹œí‚¤ëŠ” í•¨ìˆ˜

print(pd.unique(fish['Species'])) 
 
['Bream' 'Roach' 'Whitefish' 'Parkki' 'Perch' 'Pike' 'Smelt']

fish_input = fish[['Weight','Length','Diagonal','Height','Width']].to_numpy()
print(fish_input[:5]) # ì²˜ìŒ 5ê°œ ì—´ì„ ì¶œë ¥
[[242.      25.4     30.      11.52     4.02  ]
 [290.      26.3     31.2     12.48     4.3056]
 [340.      26.5     31.1     12.3778   4.6961]
 [363.      29.      33.5     12.73     4.4555]
 [430.      29.      34.      12.444    5.134 ]]
fish_target = fish['Species'].to_numpy() #Species ê°€ íƒ€ê¹ƒì´ë¨ 
from sklearn.model_selection import train_test_split

train_input, test_input, train_target, test_target = train_test_split(
    fish_input, fish_target, random_state=42)
# StandardScalerë¥¼ í†µí•´ í›ˆë ¨ì„¸íŠ¸ì™€ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¥¼ í‘œì¤€í™” ì „ì²˜ë¦¬í•¨    
from sklearn.preprocessing import StandardScaler
ss = StandardScaler()
ss.fit(train_input)
train_scaled = ss.transform(train_input)
test_scaled = ss.transform(test_input)

```

- Kìµœê·¼ì ‘ ì´ì›ƒ ë¶„ë¥˜ê¸°ì˜ í™•ë¥  ì˜ˆì¸¡

```python
from sklearn.neighbors import KNeighborsClassifier

kn = KNeighborsClassifier(n_neighbors=3)
kn.fit(train_scaled, train_target)

print(kn.score(train_scaled, train_target))
print(kn.score(test_scaled, test_target))
0.8907563025210085
0.85
print(kn.classes_) # classes_ë¥¼ ì“°ë©´ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ ë‚˜ì—´ì´ ë¨ 
['Bream' 'Parkki' 'Perch' 'Pike' 'Roach' 'Smelt' 'Whitefish']
print(kn.predict(test_scaled[:5])) # ì²˜ìŒ 5ê°œì˜ ìƒ˜í”Œë“¤ì€ ì–´ë–¤ classê°€ ë‚˜ì˜¬ ì§€ ì˜ˆì¸¡í•œ ê²ƒ 
['Perch' 'Smelt' 'Pike' 'Perch' 'Perch']

import numpy as np
proba = kn.predict_proba(test_scaled[:5]) #5ê°œ ìƒ˜í”Œì— ëŒ€í•œ ì˜ˆì¸¡ê°’ì„ ë§Œë“œëŠ” predict_proba
print(np.round(proba, decimals=4))# ì†Œìˆ˜ì  ë„·ì§¸ ìë¦¬ê¹Œì§€ í‘œê¸°í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ , 5ë²ˆì§¸ ìë¦¬ì—ì„œ ë°˜ì˜¬ë¦¼í•¨
[[0.     0.     1.     0.     0.     0.     0.    ]
 [0.     0.     0.     0.     0.     1.     0.    ]
 [0.     0.     0.     1.     0.     0.     0.    ]
 [0.     0.     0.6667 0.     0.3333 0.     0.    ]
 [0.     0.     0.6667 0.     0.3333 0.     0.    ]]
distances, indexes = kn.kneighbors(test_scaled[3:4])
print(train_target[indexes]) # roachê°€ 1/3 ê·¸ë¦¬ê³  perchê°€ 2/3ì„.
[['Roach' 'Perch' 'Perch']
```

### ğŸ¥´ë¬¸ì œ ë°œìƒ : ìµœê·¼ì ‘ì´ì›ƒ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ë©´ ì œì¼ ê·¼ì ‘í•œ ì´ì›ƒ 3ê°œë§Œ ì°¸ê³ í•¨. ê·¸ëŸ¼ ëŸ­í‚¤ë°± ë¬¼ê³ ê¸° ì˜ˆì¸¡ í™•ë¥  ìì²´ê°€ 0, 1/3, 2/3, 1 ë°–ì— ê²½ìš°ì˜ ìˆ˜ê°€ ì—†ìŒ.  â€”> ê·¸ëŸ¼ ëŸ­í‚¤ë°± í™•ë¥ ì´ CONCISE í•˜ì§€ ì•ŠìŒ !!!

### sol :  ë¡œì§€ìŠ¤í‹± íšŒê·€ë¥¼ ì“°ìâ†’ ì‹œê·¸ëª¨ì´ë“œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 181234.png](attachment:c625f886-883a-40b3-a66e-e70b36b3adb2:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_181234.png)

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 190855.png](attachment:d74f8968-3fb3-4652-97fc-e5e817627166:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_190855.png)

zê°€ ì•„ì£¼ í° ìŒìˆ˜ì¼ ë•Œ ì´ í•¨ìˆ˜ëŠ” 0ì´ë˜ê³  ì•„ì£¼ í° ì–‘ìˆ˜ì¼ ë•Œ 1ì´ ë˜ë„ë¡ ì‹œê·¸ëª¨ì´ë“œ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ë°”ê¿€ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¼0~1ì‚¬ì´ì˜ ê°’ì„ 0~100%ê¹Œì§€ í™•ë¥ ë¡œ í•´ì„í•  ìˆ˜ ìˆë‹¤ . 

```python
import numpy as np
import matplotlib.pyplot as plt

z = np.arange(-5, 5, 0.1)
phi = 1 / (1 + np.exp(-z))

plt.plot(z, phi)
plt.xlabel('z')
plt.ylabel('phi')
plt.show()
```

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 192040.png](attachment:946f8b50-a378-493c-84f3-ef6dc355574c:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_192040.png)

### ë¡œì§€ìŠ¤í‹± íšŒê·€ë¡œ ì´ì§„ ë¶„ë¥˜ ìˆ˜í–‰í•˜ê¸°

```python
char_arr = np.array(['A', 'B', 'C', 'D', 'E'])
print(char_arr[[True, False, True, False, False]])
['A' 'C']
bream_smelt_indexes = (train_target == 'Bream') | (train_target == 'Smelt')
# breamì´ê±°ë‚˜ smeltì´ê±°ë‚˜ë¡œ ë‚˜ëˆ„ê³  
train_bream_smelt = train_scaled[bream_smelt_indexes]
target_bream_smelt = train_target[bream_smelt_indexes]
from sklearn.linear_model import LogisticRegression

lr = LogisticRegression()
lr.fit(train_bream_smelt, target_bream_smelt)
#ë¡œì§€ìŠ¤í‹± íšŒê·€ë¥¼ ì´ìš©í•´ í›ˆë ¨í•˜ê¸° 
print(lr.predict(train_bream_smelt[:5]))
['Bream' 'Smelt' 'Bream' 'Bream' 'Bream']
#ì—ì¸¡í•´ë³´ë‹ˆ í•˜ë‚˜ ë¹¼ê³ ëŠ” ë‹¤ ë„ë¯¸ë¡œ ì˜ˆì¸¡í•¨.
print(lr.predict_proba(train_bream_smelt[:5]))
[[0.99760007 0.00239993]
 [0.02737325 0.97262675]
 [0.99486386 0.00513614]
 [0.98585047 0.01414953]
 [0.99767419 0.00232581]]
 
print(lr.classes_)
['Bream' 'Smelt']
print(lr.coef_, lr.intercept_)
[[-0.40451732 -0.57582787 -0.66248158 -1.01329614 -0.73123131]] [-2.16172774]
#ë¡œì§€ìŠ¤í‹± íšŒê·€ê°€ í•™ìŠµí•œ ê³„ìˆ˜ì„.
decisions = lr.decision_function(train_bream_smelt[:5])
print(decisions)
[-6.02991358  3.57043428 -5.26630496 -4.24382314 -6.06135688]
from scipy.special import expit

print(expit(decisions))
[0.00239993 0.97262675 0.00513614 0.01414953 0.00232581]
```

### ë¡œì§€ìŠ¤í‹± íšŒê·€ë¡œ ë‹¤ì¤‘ ë¶„ë¥˜ ìˆ˜í–‰í•˜ê¸°

```python
lr = LogisticRegression(C=20, max_iter=1000)
lr.fit(train_scaled, train_target)

print(lr.score(train_scaled, train_target))
print(lr.score(test_scaled, test_target))
0.9327731092436975
0.925
print(lr.predict(test_scaled[:5]))
['Perch' 'Smelt' 'Pike' 'Roach' 'Perch']
proba = lr.predict_proba(test_scaled[:5])
print(np.round(proba, decimals=3))
[[0.    0.014 0.842 0.    0.135 0.007 0.003]
 [0.    0.003 0.044 0.    0.007 0.946 0.   ]
 [0.    0.    0.034 0.934 0.015 0.016 0.   ]
 [0.011 0.034 0.305 0.006 0.567 0.    0.076]
 [0.    0.    0.904 0.002 0.089 0.002 0.001]]
```

<ì¸ì§€> : LogisticRegressionì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¦¿ì§€ íšŒê·€ì™€ ê°™ì´ ê³„ìˆ˜ì˜ ì œê³±ì„ ê·œì œí•œë‹¤. ë¦¿ì§€ íšŒê·€ì—ì„œëŠ” alphaë§¤ê°œë³€ìˆ˜ë¡œ ê·œì œì˜ ì–‘ì„ ì¡°ì ˆí–ˆë‹¤ë©´ LogisticRegressionì—ì„œëŠ” Cì˜ ê°’ì„ í†µí•´ ê·œì œì˜ ì–‘ì„ ì¡°ì ˆí•œë‹¤. CëŠ” alphaì™€ ë‹¤ë¥´ê²Œ Cì˜ ê°’ì˜ í¬ê¸°ê°€ ê·œì œì˜ ê°’ê³¼ ë°˜ë¹„ë¡€í•œë‹¤.(ê¸°ë³¸ê°’:1)

ë˜í•œ max_iterëŠ” ë°˜ë³µíšŸìˆ˜ë¥¼ í†µì¹­

```python
print(lr.classes_)
['Bream' 'Parkki' 'Perch' 'Pike' 'Roach' 'Smelt' 'Whitefish']
print(lr.coef_.shape, lr.intercept_.shape)
(7, 5) (7,)
decision = lr.decision_function(test_scaled[:5])
print(np.round(decision, decimals=2))
[[ -6.51   1.04   5.17  -2.76   3.34   0.35  -0.63]
 [-10.88   1.94   4.78  -2.42   2.99   7.84  -4.25]
 [ -4.34  -6.24   3.17   6.48   2.36   2.43  -3.87]
 [ -0.69   0.45   2.64  -1.21   3.26  -5.7    1.26]
 [ -6.4   -1.99   5.82  -0.13   3.5   -0.09  -0.7 ]]
 from scipy.special import softmax

proba = softmax(decision, axis=1)
print(np.round(proba, decimals=3))
[[0.    0.014 0.842 0.    0.135 0.007 0.003]
 [0.    0.003 0.044 0.    0.007 0.946 0.   ]
 [0.    0.    0.034 0.934 0.015 0.016 0.   ]
 [0.011 0.034 0.305 0.006 0.567 0.    0.076]
 [0.    0.    0.904 0.002 0.089 0.002 0.001]]
```

<ì¸ì§€> : ë‹¤ì¤‘ë¶„ë¥˜ì—ì„œëŠ” ì´ì§„ë¶„ë¥˜ì™€ ë‹¤ë¥´ê²Œ ì†Œí”„íŠ¸ë§¥ìŠ¤ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 193807.png](attachment:bdae2c1e-b9be-48f2-846b-5214509132a5:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_193807.png)

## 4-2 í™•ë¥ ì  ê²½ì‚¬ í•˜ê°•ë²•

â†’ ì ì§„ì  í•™ìŠµì„ ìœ„í•œ í™•ë¥ ì  ê²½ì‚¬ í•˜ê°•ë²•

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 202257.png](attachment:3e3fb07b-a8cf-498a-ab46-d8ddf56fddd6:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_202257.png)

  1. í™•ë¥ ì  ê²½ì‚¬ í•˜ê°•ë²• :ì „ì²´ ìƒ˜í”Œì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë”± í•˜ë‚˜ì˜ ìƒ˜í”Œì„ í›ˆë ¨ ì„¸íŠ¸ì—ì„œ ëœë¤í•˜ê²Œ ê³ ë¥´ëŠ” ê²ƒ 

1. ë¯¸ë‹ˆë°°ì¹˜ ê²½ì‚¬ í•˜ê°•ë²•: 1ê°œì”©ì´ ì•„ë‹ˆê³  ë¬´ì‘ìœ„ë¡œ ëª‡ ê°œì˜ ìƒ˜í”Œì„ ì„ íƒí•´ì„œ ê²½ì‚¬ë¥¼ ë”°ë¼ ë‚´ë ¤ê°€ëŠ” ë°©ë²•ì„(ì—¬ëŸ¬ê°œì˜ ìƒ˜í”Œ ì‚¬ìš©)
2. ë°°ì¹˜ ê²½ì‚¬ í•˜ê°•ë²• : ê·¹ë‹¨ì ìœ¼ë¡œ í•œ ë²ˆ , ì „ì²´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ 
3. ì†ì‹¤í•¨ìˆ˜ : ì–´ë–¤ ë¬¸ì œì—ì„œ ë¨¸ì‹ ëŸ¬ë‹ ì•Œê³ ë¦¬ì¦˜ì´ ì–¼ë§ˆë‚˜ ì—‰í„°ë¦¬ì¸ì§€ë¥¼ ì¸¡ì •í•˜ëŠ” ê¸°ì¤€â†’ ë‹¹ì—°íˆ ê°’ì´ ì‘ì„ ìˆ˜ë¡ ì¢‹ìŒ. 

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 202856.png](attachment:f6a5990b-1b0c-4a35-af51-6fb763b816bb:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_202856.png)

â€”> ë‹¤ì¤‘ë¶„ë¥˜ì—ì„œëŠ” í¬ë¡œìŠ¤ì—”íŠ¸ë¡œí”¼ ì†ì‹¤ í•¨ìˆ˜ë¼ê³  ë¶€ë¥¸ë‹¤. 

### Codeë¡œ ì•Œì•„ë³´ê¸°

```python
import pandas as pd

fish = pd.read_csv('https://bit.ly/fish_csv_data')
fish_input = fish[['Weight','Length','Diagonal','Height','Width']].to_numpy()
fish_target = fish['Species'].to_numpy()
from sklearn.model_selection import train_test_split

train_input, test_input, train_target, test_target = train_test_split(
    fish_input, fish_target, random_state=42)
from sklearn.preprocessing import StandardScaler

ss = StandardScaler()
ss.fit(train_input)
train_scaled = ss.transform(train_input)
test_scaled = ss.transform(test_input)
from sklearn.linear_model import SGDClassifier
sc = SGDClassifier(loss='log_loss', max_iter=10, random_state=42)
sc.fit(train_scaled, train_target)

print(sc.score(train_scaled, train_target))
print(sc.score(test_scaled, test_target))
0.773109243697479
0.775

sc.partial_fit(train_scaled, train_target) #ëª¨ë¸ì„ ì´ì–´ì„œ í›ˆë ¨ í•  ë–„ ì‚¬ìš©

print(sc.score(train_scaled, train_target))
print(sc.score(test_scaled, test_target))
0.8151260504201681
0.85
```

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 203319.png](attachment:7ddd001b-d7f4-4a16-a62a-64c7b353faf1:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_203319.png)

```python
import numpy as np

sc = SGDClassifier(loss='log_loss', random_state=42)

train_score = []
test_score = []

classes = np.unique(train_target)
#300ë²ˆ ë™ì•ˆ ë°˜ë³µí•¨
for _ in range(0, 300): # ë‚˜ì¤‘ì— ì‚¬ìš©í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ ë²„ë¦¬ëŠ” ê°’ì„ ë„£ì–´ë‘ëŠ” ìš©ë„ë¡œ ì‚¬ìš© _
    sc.partial_fit(train_scaled, train_target, classes=classes)

    train_score.append(sc.score(train_scaled, train_target))
    test_score.append(sc.score(test_scaled, test_target))
import matplotlib.pyplot as plt

plt.plot(train_score)
plt.plot(test_score)
plt.xlabel('epoch')
plt.ylabel('accuracy')
plt.show()
```

![ìŠ¤í¬ë¦°ìƒ· 2025-10-29 203509.png](attachment:2cbff1da-62e0-405d-aaa1-5fd5f49d6b0f:ìŠ¤í¬ë¦°ìƒ·_2025-10-29_203509.png)
